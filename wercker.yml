box: node

build:
  steps:
    - npm-install
    - npm-test

    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"

docker-push:
  steps:
    - script:
        name: debug
        code: |
          echo "und...?"
          echo "$GCR_JSON_KEY_FILE"
    - internal/docker-push:
        username: _json_key
        password: $GCR_JSON_KEY_FILE
        repository: gcr.io/swarm-sandbox/jbaas
        tag: $WERCKER_GIT_COMMIT
        registry: https://gcr.io

rolling-update:
  - kubectl:
      server: $KUBERNETES_MASTER
      username: $KUBERNETES_USERNAME
      password: $KUBERNETES_PASSWORD
      insecure-skip-tls-verify: true
      command: rolling-update cities
      image: gcr.io/swarm-sandbox/jbaas:$WERCKER_GIT_COMMIT
